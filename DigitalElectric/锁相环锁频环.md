
- [鉴相鉴频器 (PFD) 的工作原理](#鉴相鉴频器-pfd-的工作原理)
  - [1. 信号输入和输出](#1-信号输入和输出)
  - [2. 比较的器件特性：D触发器和边沿触发](#2-比较的器件特性d触发器和边沿触发)
  - [3. 如何测量相位和频率误差？](#3-如何测量相位和频率误差)
    - [A. 比较相位（已频率锁定）](#a-比较相位已频率锁定)
    - [B. 比较频率（初始捕获时）](#b-比较频率初始捕获时)
- [电荷泵 (CP) 的器件特性](#电荷泵-cp-的器件特性)
  - [1. 核心特性：将时间转化为电荷（电压）](#1-核心特性将时间转化为电荷电压)
  - [2. 环路滤波器（LF）的配合](#2-环路滤波器lf的配合)
- [锁相环](#锁相环)
  - [1.基本概念](#1基本概念)
  - [2.组成结构](#2组成结构)
  - [3.核心模块解释](#3核心模块解释)
  - [4.工作原理简述](#4工作原理简述)





## 鉴相鉴频器 (PFD) 的工作原理

PFD 的核心特性在于它**不仅比较相位，还比较频率**，这使得 PLL 的捕获范围更广、锁定更快。PFD 通常由两个**D触发器（D Flip-Flops）**和**一个复位逻辑门（AND Gate）**构成。

### 1. 信号输入和输出

| 输入信号 (Inputs) | 作用 |
| :--- | :--- |
| **R** (Reference) | 参考时钟，来自晶振或外部稳定源。 |
| **V** (Variable) | 反馈时钟，来自压控振荡器（VCO）的分频输出。 |

| 输出信号 (Outputs) | 作用 |
| :--- | :--- |
| **UP** | 当 R **超前** V 时，输出高电平脉冲。 |
| **DOWN** | 当 V **超前** R 时，输出高电平脉冲。 |

### 2. 比较的器件特性：D触发器和边沿触发

PFD 的比较机制是基于**时钟的上升沿**（或下降沿）的**时序**。

1.  **时钟边沿触发：** R 和 V 信号的**上升沿**分别触发两个 D 触发器。
2.  **状态保持：** 被触发的 D 触发器将 **UP** 或 **DOWN** 输出置为高电平，并**保持**该状态。
3.  **复位机制：** 当第二个时钟沿（R 或 V 的另一个上升沿）到达后，两个 D 触发器的输出（UP 和 DOWN）同时通过一个复位逻辑门，将两个 D 触发器**同时复位**为低电平。

### 3. 如何测量相位和频率误差？

PFD 巧妙地将相位和频率的差异转化为**脉冲宽度**：

#### A. 比较相位（已频率锁定）

假设 $F_R = F_V$（频率已锁定）：

* 如果 **R 相位超前 V**：R 的上升沿先到，UP 被置为高电平；V 的上升沿后到，触发复位。UP 脉冲的**宽度**正比于 $R$ 和 $V$ 之间的**相位差** $\Delta\phi$。
* 如果 **V 相位超前 R**：V 的上升沿先到，DOWN 被置为高电平；R 的上升沿后到，触发复位。DOWN 脉冲的**宽度**正比于 $\Delta\phi$。

#### B. 比较频率（初始捕获时）

假设 $F_R \neq F_V$（频率未锁定）：

* 如果 **$F_R > F_V$**：$R$ 的上升沿会比 $V$ 的上升沿更频繁地到达。PFD 将在大部分时间内输出 **UP 脉冲**，且 UP 脉冲的**平均宽度**远大于 DOWN 脉冲。
* 如果 **$F_V > F_R$**：$V$ 的上升沿会更频繁地到达。PFD 将输出主要的 **DOWN 脉冲**。

---

## 电荷泵 (CP) 的器件特性

PFD 的输出是 **UP/DOWN 脉冲**，无法直接控制 VCO 的模拟电压。这时就需要**电荷泵**出场，它是一个**电流源**与**开关**的组合。

### 1. 核心特性：将时间转化为电荷（电压）

电荷泵的作用是根据 PFD 的脉冲将**电流**注入或抽出环路滤波器。

| PFD 输出 | CP 动作 | 结果 |
| :--- | :--- | :--- |
| **UP 脉冲** | 导通一个**正电流源** $I_P$ | 向环路滤波器**注入正电荷**。 |
| **DOWN 脉冲** | 导通一个**负电流源** $I_N$ | 从环路滤波器**抽出负电荷**。 |
| **UP/DOWN 都低** | 所有电流源关闭（高阻态） | 保持环路滤波器上的**电压不变**。 |

### 2. 环路滤波器（LF）的配合

电荷泵输出的电流（$I_{CP}$）流经**环路滤波器（通常是一个电容 $C$）**。

$$\Delta V = \frac{1}{C} \int I_{CP} dt$$

由于电压 $V_{cont}$ 是电流对时间的**积分**：

* **PFD 输出 UP 脉冲时间越长**（相位超前越大），注入的**电荷越多**，环路滤波器的**电压 $V_{cont}$ 升高**越大。
* **PFD 输出 DOWN 脉冲时间越长**（相位落后越大），抽出的**电荷越多**，环路滤波器的**电压 $V_{cont}$ 下降**越大。

这个 $V_{cont}$ 电压就是用来控制 **VCO** 的核心信号，通过这个过程，PFD/CP 组合完成了从**时序差异**（相位/频率）到**可调电压**的完美转换，从而驱动 PLL 走向锁定。



## 锁相环
### 1.基本概念
锁相环本质上是一个**负反馈系统**，其核心目标是迫使其输出信号的**相位**和**频率**与输入参考信号的相位和频率保持锁定关系（或一个精确的倍数关系）
### 2.组成结构
```lua
    +-----------------------+
    |                       v
    +----------+   +-------+   +--------+        +------------+
    | 参考信号 |-->|鉴相器  |-->| 低通滤波器 |-->  |压控振荡器VCO|
    +----------+   +-------+   +--------+        +------------+
                                            | ↑
                                            | |
                                           +--+
                                           | ÷N |（可选分频器）
                                           +--+

```

### 3.核心模块解释

| 模块                          | 功能                              |
| --------------------------- | ------------------------------- |
| **鉴相器（Phase Detector, PD）** | 检测参考信号和反馈信号之间的相位差，输出误差信号（电压或电流） |
| **低通滤波器（Loop Filter）**      | 平滑鉴相器输出，去除高频分量，得到控制信号           |
| **压控振荡器（VCO）**              | 根据控制电压调整输出信号频率（和相位）             |
| **反馈分频器（÷N）**               | 反馈路径中用于分频，使PLL支持倍频或分频合成         |

### 4.工作原理简述

 - 初始时，VCO输出与参考信号有相位差；
 - 鉴相器检测到相位误差并输出电压；
 - 滤波器输出电压控
 - 系统逐步调整，直到反馈信号相位 ≈ 参考信号；
 - 达到锁定状态，保持相位同步；
 - 可通过反馈分频器实现频率合成（Fout = N × Fref）。